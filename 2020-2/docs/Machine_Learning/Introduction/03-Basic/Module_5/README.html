


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis In-Depth Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">Introduction to Machine Learning with Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Accelerators/README.html">Introduction to Vitis Hardware Accelerators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Accelerators/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Accelerators/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../AI_Engine_Development/README.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Creation Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/README.html">Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT and Vitis System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Runtime_and_System_Optimization/README.html">Xilinx Runtime (XRT) and Vitis System Optimization Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/Vitis-Tutorials-2019.2-Hotfix1/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../../_sources/Machine_Learning/Introduction/03-Basic/Module_5/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis In-Depth Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Work with Networks in Vitis AI Docker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/Machine_Learning/Introduction/03-Basic/Module_5/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="work-with-networks-in-vitis-ai-docker">
<h1>Work with Networks in Vitis AI Docker<a class="headerlink" href="#work-with-networks-in-vitis-ai-docker" title="Permalink to this headline">¶</a></h1>
<p>This module introduces how to use networks and scripts from Vitis AI model zoo to do following tasks in Vitis AI docker:</p>
<ul class="simple">
<li><p>prepare dataset</p></li>
<li><p>evaluate pretrained float model and quantized model, including test images and test accuracy</p></li>
<li><p>retrain the model</p></li>
<li><p>use Vitis AI toolchain to generate files for deployment</p></li>
</ul>
<p>We will use Caffe RefineDet network as example in this tutorial. More examples with other framework will be added in the future.</p>
<div class="section" id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Internet connection is avaliable</p></li>
<li><p>Vitis AI docker succesfully starts</p></li>
<li><p>Conda environment ‘vitis-ai-caffe’ is enabled by <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">vitis-ai-caffe</span></code></p></li>
<li><p>ZCU104 board is up and running with Vitis AI release image</p></li>
</ul>
</div>
<div class="section" id="download-network-package-from-vitis-ai-model-zoo">
<h2>Download Network Package from Vitis AI Model Zoo<a class="headerlink" href="#download-network-package-from-vitis-ai-model-zoo" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/Xilinx/Vitis-AI/tree/master/AI-Model-Zoo">Vitis AI model zoo</a> provides a varity of networks pre-trained in Caffe/TensorFlow/DarkNet, covering different applications including but not limited to image classification, ADAS/AD, video surveillance and etc. Several mainstream networks are further optimized using <a class="reference external" href="https://www.xilinx.com/member/ai_optimizer.html">Xilinx Optmizer</a> to achieve much higher performance.</p>
<p>In each network packages, float models and quantized models are provided together with training and evaluation scripts. We use Caffe <a class="reference external" href="https://arxiv.org/abs/1711.06897">RefineDet</a> (No. 12 model in the Model Zoo) to build people detection application.</p>
<p>RefineDet is an one-stage objection detection network that could achieve better accuracy than two-stage networks before
publication but still maintains comparable speed performance of one-stage networks.</p>
<p>RefineDet can be seen as an improved version of SSD with addition of anchor refinement module (ARM), object detection m
and transfer connection block (TCB) to improve accuracy.</p>
<p>The detailed introduction about network itself is beyond the scope of this module, please refer to the original paper.</p>
<div class="section" id="get-refinedet-model-package">
<h3>Get RefineDet Model Package<a class="headerlink" href="#get-refinedet-model-package" title="Permalink to this headline">¶</a></h3>
<p>After the git clone the whole repository, go to the module 5 folder (Vitis-In-Depth-Tutorial/Machine_Learning_Tutorial/Section_3-Basic/Module_5) and run <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">get_network.sh</span></code> to download RefineDet network package, which is trained with people subset selected from COCO2014 and optimized to reduce 96% of the computation complexity (GOP).</p>
<p>If no error occurs, your workspace in module 5 folder will be like below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Module_5/
|-- cf_refinedet_coco_480_360_0.96_5.08G
|   |-- codeco_480_360_0.96_5.08G
|   |-- code_bak
|   |-- data
|   |-- float
|   |-- labelmap.prototxt
|   |-- quantizedototxt
|   `-- readme.md
|-- cf_refinedet_coco_baseline_125G
|   |-- refinedet_baseline.prototxtco_baseline_125G
|   `-- solver.prototxtaseline.prototxt
|-- get_network.sh
|-- network_training.mdg.md
|-- README.mdts
|-- reference_scripts
|   `-- code
`-- res_output.jpg
</pre></div>
</div>
<p>Go to folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_480_360_0.96_5.08G</span></code> and follow the steps described below to start the real works.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cf_refinedet_coco_480_360_0.96_5.08G/
├── code
│   ├── gen_data
│   │   ├── convert_coco2voc_like.py
│   │   ├── create_data.py
│   │   └── get_dataset.sh
│   ├── test
│   │   ├── demo
│   │   │   ├── COCO_val2014_000000209468.jpg
│   │   │   ├── COCO_val2014_000000425226.jpg
│   │   │   └── res_output.jpg
│   │   ├── demo.py
│   │   ├── evaluation_py2.py
│   │   └── test.py
│   └── train
│       ├── convert_coco2voc_like.py
│       ├── create_data.py
│       ├── solver.prototxt
│       └── train.sh
├── data
├── float
│   ├── test.prototxt
│   ├── trainval.caffemodel
│   └── trainval.prototxt
├── labelmap.prototxt
├── quantized
│   ├── deploy.caffemodel
│   ├── deploy.prototxt
│   ├── quantize_test.prototxt
│   ├── quantize_train_test.caffemodel
│   └── quantize_train_test.prototxt
└── readme.md
</pre></div>
</div>
</div>
</div>
<div class="section" id="modify-scripts-to-be-python3-compatible">
<h2>Modify Scripts to be Python3 Compatible<a class="headerlink" href="#modify-scripts-to-be-python3-compatible" title="Permalink to this headline">¶</a></h2>
<p>Vitis AI docker is built with Python3 environment while Caffe is developed originally with Python2. Hence Minor modificaiton in several scripts are needed to be Python3 compatible. Ready-to-use scripts are prepared and located in folder <code class="docutils literal notranslate"><span class="pre">reference</span> <span class="pre">scripts</span></code>, which will be copied into code folder for simplicity when running “get_network.sh”.</p>
<p>Detailed modifications are as below</p>
<ul>
<li><p>create_annoset.py</p>
<p>change <code class="docutils literal notranslate"><span class="pre">print</span></code> to <code class="docutils literal notranslate"><span class="pre">print()</span></code></p>
<p>change the command and path to call Caffe prebuilt binaries</p>
</li>
<li><p>/code/gen_data/create_data.py</p>
<p>change <code class="docutils literal notranslate"><span class="pre">print</span></code> to <code class="docutils literal notranslate"><span class="pre">print()</span></code></p>
<p>change <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">commands</span></code> to <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">subprocess</span></code></p>
<p>change <code class="docutils literal notranslate"><span class="pre">commands.getoutput()</span></code> to <code class="docutils literal notranslate"><span class="pre">subprocess.getoutput()</span></code></p>
<p>change the path to the script <code class="docutils literal notranslate"><span class="pre">create_annoset.py</span></code> in line 122 according to your environment</p>
</li>
<li><p>/code/test/test.py</p>
<p>change <code class="docutils literal notranslate"><span class="pre">print</span></code> to <code class="docutils literal notranslate"><span class="pre">print()</span></code></p>
<p>change <code class="docutils literal notranslate"><span class="pre">xrange</span></code> to <code class="docutils literal notranslate"><span class="pre">range</span></code></p>
<p>comment line 91 to let script use python env in conda</p>
<p>change GPU ID in line 171 if nessaray, default value is 3</p>
</li>
</ul>
</div>
<div class="section" id="prepare-customized-coco-dataset">
<h2>Prepare Customized COCO Dataset<a class="headerlink" href="#prepare-customized-coco-dataset" title="Permalink to this headline">¶</a></h2>
<p>COCO is a large-scale object detection, segmentation, and captioning dataset including 330K images (&gt;200K labeled) in 91 object types, which are used widely in ML/AI researches. For detailed information about the dataset, please refer to <a class="reference external" href="https://cocodataset.org/#home">COCO official website</a>.</p>
<p>If you would like to retrain the network, evaluate mAP before directly deploying the network on board, the COCO dataset used by this network needs to be prepared with necessary process.</p>
<p>Related scripts are provided in folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_480_360_0.96_5.08G/code/gen_data</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gen_data/
|-- convert_coco2voc_like.py
|-- create_annoset.py
|-- create_data.py
`-- get_dataset.sh
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">get_dataset.sh</span></code> to download and generate the dataset which only contains <strong>one class</strong> <em>person</em> seleted from COCO2014. If you already have COCO2014 in the hard drive, please comment the download code in <code class="docutils literal notranslate"><span class="pre">get_dataset.sh</span></code> and put COCO2014 files into folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_480_360_0.96_5.08G/data</span></code> for simplicity, in which the expected file structure is shown as below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">coco2014</span><span class="o">/</span>
      <span class="o">|-&gt;</span><span class="n">train2014</span><span class="o">/</span>
      <span class="o">|-&gt;</span><span class="n">val2014</span><span class="o">/</span>
      <span class="o">|-&gt;</span><span class="n">instances_train2014</span><span class="o">.</span><span class="n">json</span>
      <span class="o">|-&gt;</span><span class="n">instances_val2014</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>If the script finishes without error, the generated LMBD files and images will have following structure</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>data/
|-- coco2014
|   |-- Annotations
|   |-- Images
|   |-- instances_train2014.json
|   |-- instances_val2014.json
|   |-- train2014.txt
|   |-- train_image2anno.txt
|   |-- val2014.txt
|   `-- val_image2anno.txt
|-- coco2014_lmdb
|   |-- train2014_lmdb
|   `-- val2014_lmdb
|-- link_480_360
|   |-- train2014_lmdb -&gt; ../../data/coco2014_lmdb/train2014_lmdb
|   `-- val2014_lmdb -&gt; ../../data/coco2014_lmdb/val2014_lmdb
`-- test_name_size.txt
</pre></div>
</div>
<p>If the script finishes with out error, the md5sum values of train and val mdb files are as below:</p>
<p>|                 File Name                  |           Md5sum Value           |
| :—————————————-: | :——————————: |
| data/coco2014_lmdb/train2014_lmdb/data.mdb | 39891c36467f22498a98cbd431e43657 |
|  data/coco2014_lmdb/val2014_lmdb/data.mdb  | e99d3ad2ce3d5ffc864fa8d41b01d4b0 |</p>
</div>
<div class="section" id="from-official-refinedet-to-model-zoo-version">
<h2>From Official RefineDet to Model Zoo Version<a class="headerlink" href="#from-official-refinedet-to-model-zoo-version" title="Permalink to this headline">¶</a></h2>
<p>The model zoo package provides Xilinx version RefineDet with modifications on model struture to make it compatible with Vitis AI, and also network pruning optimization by Vitis AI optimizer.</p>
<p>The <strong><a class="reference internal" href="network_training.html"><span class="doc">Journey from Original RefineDet</span></a></strong> documents the steps in detail of how to start from original model and arrive at the baseline version (not optimized, 125GOPs) of that in the model zoo package (optimized, 5GOPs model used in this example, 25GOPs and 10GOPs models also proivded in the model zoo). The pretrained baseline model is provided here and could be used in following parts.</p>
<p>In advanced section, there will be a seperate module to documents the workflow of AI optimizer and the steps to prune the model from baseline to optimized version.</p>
</div>
<div class="section" id="work-with-vitis-ai-toolchain">
<h2>Work with Vitis AI Toolchain<a class="headerlink" href="#work-with-vitis-ai-toolchain" title="Permalink to this headline">¶</a></h2>
<p>Vitis AI toolchain is used to quantize float 32bit network model into INT8 model with optimization and then compile it into instructions which run efficiently on the DPU in FPGA. The toolchain could support Caffe, DarkNet and TensorFlow framework.</p>
<p>Comprehensive introduction of Vitis AI toolchain can be found in <a class="reference external" href="https://www.xilinx.com/html_docs/vitis_ai/1_2/zkj1576857115470.html">Vitis AI User Documentation
</a>.Here we only use RefineDet as example to demostrate Caffe workflow. The following steps are based on network package from model zoo (cf_refinedet_coco_480_360_0.96_5.08G), but it could be easily used with baseline model with some changes on file paths in scripts, prototxt and commands.</p>
<div class="section" id="span-id-tool-evaluate-model-span">
<h3><span id = "tool">Evaluate Model</span><a class="headerlink" href="#span-id-tool-evaluate-model-span" title="Permalink to this headline">¶</a></h3>
<p>In the network package, both float model and quantized model are provided together with evaluation script to run single images or test mAP over whole validation dataset. These scripts work with baseline model as well.</p>
</div>
<div class="section" id="run-single-image">
<h3>Run single image<a class="headerlink" href="#run-single-image" title="Permalink to this headline">¶</a></h3>
<p>Go to folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_480_360_0.96_5.08G/code/test</span></code> and run the network on single image with command <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">demo.py</span></code>. The output image will be stored in <code class="docutils literal notranslate"><span class="pre">output/res_output.jpg</span></code>. If you would like to use different image, please modify the image path in the <code class="docutils literal notranslate"><span class="pre">demo.py</span></code>.</p>
<p><img alt="Inference result" src="../../../../_images/res_output.jpg" /></p>
</div>
<div class="section" id="test-map">
<h3>Test mAP<a class="headerlink" href="#test-map" title="Permalink to this headline">¶</a></h3>
<p>The network package provides scripts to varify the mAP of the pretrained network (both float model and quantized model). To use the scripts, please make sure the evaluation dataset are correctly prepared and file paths in function ‘parse_args’ (line 54 to 85 in <code class="docutils literal notranslate"><span class="pre">test.py</span></code>)  are modified according to your environment.</p>
<p>By default, the script will evaluate float model (trainval.caffemodel and test.prototxt) stored under folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_480_360_0.96_5.08G/float</span></code>.</p>
<p>Use command <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">test.py</span></code> to run the evaluation which will takes around 30~60 minutes depending on your CPU/GPU capability. If no error occurs, it will display the mAP result as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluate</span> <span class="mi">21634</span> <span class="n">images</span>
<span class="n">person</span> <span class="n">AP</span><span class="p">:</span> <span class="mf">0.6120284761439228</span>
<span class="n">mAP</span><span class="p">:</span> <span class="mf">0.612028476144</span>
</pre></div>
</div>
<p>It’s also easy to evaluate quantized model in the same way, just change the prototxt file and caffemodel file in the script into <code class="docutils literal notranslate"><span class="pre">quantize_test.prototxt</span></code> and <code class="docutils literal notranslate"><span class="pre">quantize_train_test.caffemodel</span></code>. After evaluation is finished the result will be displayed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluate</span> <span class="mi">21634</span> <span class="n">images</span>
<span class="n">person</span> <span class="n">AP</span><span class="p">:</span> <span class="mf">0.6112254774886302</span>
<span class="n">mAP</span><span class="p">:</span> <span class="mf">0.611225477489</span>
</pre></div>
</div>
<p>The float baseline model could also be evaluated using the same script, just change the prototxt file and caffemodel file into <code class="docutils literal notranslate"><span class="pre">refinedet_baseline.prototxt</span></code> and <code class="docutils literal notranslate"><span class="pre">refinedet_baseline.caffemodel</span></code> in folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_baseline_125G</span></code>.</p>
</div>
</div>
<div class="section" id="deploy-model">
<h2>Deploy Model<a class="headerlink" href="#deploy-model" title="Permalink to this headline">¶</a></h2>
<div class="section" id="quantize-float-model">
<h3>Quantize Float Model<a class="headerlink" href="#quantize-float-model" title="Permalink to this headline">¶</a></h3>
<p>The ready-to-use quantized models are already provided in the package. If you would like to try the quantization steps by yourself, detailed explaination could be found in <a class="reference external" href="https://www.xilinx.com/html_docs/vitis_ai/1_2/uim1570695919827.html">Vitis AI User Documentation
</a>.</p>
<p>For Caffe example, the <code class="docutils literal notranslate"><span class="pre">vai_q_caffe</span></code> will be used to execute quantization with following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vai_q_caffe</span> <span class="n">quantize</span> <span class="o">-</span><span class="n">model</span> <span class="n">trainval</span><span class="o">.</span><span class="n">prototxt</span> \
                     <span class="o">-</span><span class="n">weights</span> <span class="n">trainval</span><span class="o">.</span><span class="n">caffemodel</span> \
                     <span class="o">-</span><span class="n">calib_iter</span> <span class="mi">20</span> \
                     <span class="o">-</span><span class="n">auto_test</span>  \
                     <span class="o">-</span><span class="n">test_iter</span> <span class="mi">2100</span> \
                     <span class="o">-</span><span class="n">output_dir</span> <span class="n">quantization</span> \
                     <span class="o">-</span><span class="n">gpu</span> <span class="mi">0</span> \
                     <span class="o">-</span><span class="n">ignore_layers</span> <span class="n">arm_priorbox</span>
</pre></div>
</div>
<p>Plesse note that the ‘arm_priorbox’ (which concats all previous priorbox layer together) needs to be ignored because it will not run on DPU and quantization will affect bounding box results. Generated quantized model will be stored in the folder spcified by <code class="docutils literal notranslate"><span class="pre">-output_dir</span></code>, which in this case is <code class="docutils literal notranslate"><span class="pre">quantization</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>I0527 01:37:05.329720  9006 net_test.cpp:212] Test iter: 2100/2100
I0527 01:37:05.755471  9006 net_test.cpp:259] Test Results:
I0527 01:37:05.755494  9006 net_test.cpp:260]     Test net output #0: detection_eval = 0.610996
I0527 01:37:05.757798  9006 net_test.cpp:398] Test Done!
I0527 01:37:06.175303  9006 decent_q.cpp:361] Start Deploy
I0527 01:37:06.209132  9006 decent_q.cpp:369] Deploy Done!
--------------------------------------------------
Output Quantized Train&amp;Test Model:   &quot;quantization/quantize_train_test.prototxt&quot;
Output Quantized Train&amp;Test Weights: &quot;quantization/quantize_train_test.caffemodel&quot;
Output Deploy Weights: &quot;quantization/deploy.caffemodel&quot;
Output Deploy Model:   &quot;quantization/deploy.prototxt&quot;
</pre></div>
</div>
<p>Using the same step and command, we could also generate quantized model for baseline model and use in next step compilation. Please make sure right models are used as you wish and output files are saved properly.</p>
</div>
<div class="section" id="compile-quantized-model">
<h3>Compile Quantized Model<a class="headerlink" href="#compile-quantized-model" title="Permalink to this headline">¶</a></h3>
<p>To deploy quantized model on board, we use <code class="docutils literal notranslate"><span class="pre">vai_c_caffe</span></code> to generate elf file by compiling deploy.prototxt and deploy.caffemodel. Here we could use files in both folder <code class="docutils literal notranslate"><span class="pre">cf_refinedet_coco_480_360_0.96_5.08G/quantized</span></code> (provided in the network package) or <code class="docutils literal notranslate"><span class="pre">quantization</span></code> (generated by ourselves, please check where you put it).</p>
<p>Before compilation, in the any deploy.prototxt, please make sure all the layers after the layer block <code class="docutils literal notranslate"><span class="pre">odm_conf</span></code> are deleted as they are not needed for deployment and compilation .</p>
<p>Run below command in the quantized model folder to compile the model in to elf file which targeting DPU on ZCU104 released board image</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vai_c_caffe</span> <span class="o">--</span><span class="n">prototxt</span>    <span class="n">deploy</span><span class="o">.</span><span class="n">prototxt</span> \
            <span class="o">--</span><span class="n">caffemodel</span>  <span class="n">deploy</span><span class="o">.</span><span class="n">caffemodel</span> \
            <span class="o">--</span><span class="n">arch</span>        <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">vitis_ai</span><span class="o">/</span><span class="n">compiler</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">DPUCZDX8G</span><span class="o">/</span><span class="n">ZCU104</span><span class="o">/</span><span class="n">ZCU104</span><span class="o">.</span><span class="n">json</span> \
            <span class="o">--</span><span class="n">output_dir</span>  <span class="n">board_file_zcu104_5G</span> \
            <span class="o">--</span><span class="n">net_name</span>    <span class="n">refinedet_5G</span> \
            <span class="o">--</span><span class="n">options</span>     <span class="s2">&quot;{&#39;save_kernel&#39;:&#39;&#39;}&quot;</span>
</pre></div>
</div>
<p>Please note that you could also specify the path for prototxt, caffemodel and output_dir as you wish.</p>
<p>During compilation, the compiler will give following output which will show useful informations including kernel name, input tensor names, input tensor shapes, output tensor names and output tensor shapes. With <code class="docutils literal notranslate"><span class="pre">save_kernel</span></code> option used, these informations are saved in <code class="docutils literal notranslate"><span class="pre">refinedet_kernel.info</span></code> in <code class="docutils literal notranslate"><span class="pre">board_file_zcu104_5G</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**************************************************</span>
<span class="o">*</span> <span class="n">VITIS_AI</span> <span class="n">Compilation</span> <span class="o">-</span> <span class="n">Xilinx</span> <span class="n">Inc</span><span class="o">.</span>
<span class="o">**************************************************</span>

<span class="n">Kernel</span> <span class="n">topology</span> <span class="s2">&quot;refinedet_5G_kernel_graph.jpg&quot;</span> <span class="k">for</span> <span class="n">network</span> <span class="s2">&quot;refinedet_5G&quot;</span>
<span class="n">kernel</span> <span class="nb">list</span> <span class="n">info</span> <span class="k">for</span> <span class="n">network</span> <span class="s2">&quot;refinedet_5G&quot;</span>
                               <span class="n">Kernel</span> <span class="n">ID</span> <span class="p">:</span> <span class="n">Name</span>
                                       <span class="mi">0</span> <span class="p">:</span> <span class="n">refinedet_5G</span>

                             <span class="n">Kernel</span> <span class="n">Name</span> <span class="p">:</span> <span class="n">refinedet_5G</span>
<span class="o">--------------------------------------------------------------------------------</span>
                             <span class="n">Kernel</span> <span class="n">Type</span> <span class="p">:</span> <span class="n">DPUKernel</span>
                               <span class="n">Code</span> <span class="n">Size</span> <span class="p">:</span> <span class="mf">0.14</span><span class="n">MB</span>
                              <span class="n">Param</span> <span class="n">Size</span> <span class="p">:</span> <span class="mf">0.32</span><span class="n">MB</span>
                           <span class="n">Workload</span> <span class="n">MACs</span> <span class="p">:</span> <span class="mf">5084.69</span><span class="n">MOPS</span>
                         <span class="n">IO</span> <span class="n">Memory</span> <span class="n">Space</span> <span class="p">:</span> <span class="mf">3.35</span><span class="n">MB</span>
                              <span class="n">Mean</span> <span class="n">Value</span> <span class="p">:</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span>
                      <span class="n">Total</span> <span class="n">Tensor</span> <span class="n">Count</span> <span class="p">:</span> <span class="mi">53</span>
                <span class="n">Boundary</span> <span class="n">Input</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
                               <span class="n">data</span><span class="p">:</span><span class="mi">0</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">360</span><span class="o">*</span><span class="mi">480</span><span class="o">*</span><span class="mi">3</span>

               <span class="n">Boundary</span> <span class="n">Output</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
                            <span class="n">arm_loc</span><span class="p">:</span><span class="mi">0</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">48960</span>
                           <span class="n">arm_conf</span><span class="p">:</span><span class="mi">0</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">24480</span>
                            <span class="n">odm_loc</span><span class="p">:</span><span class="mi">0</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">48960</span>
                           <span class="n">odm_conf</span><span class="p">:</span><span class="mi">0</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">24480</span>

                        <span class="n">Total</span> <span class="n">Node</span> <span class="n">Count</span> <span class="p">:</span> <span class="mi">52</span>
                           <span class="n">Input</span> <span class="n">Node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
                              <span class="n">conv1_1</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">360</span><span class="o">*</span><span class="mi">480</span><span class="o">*</span><span class="mi">3</span>

                          <span class="n">Output</span> <span class="n">Node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
                              <span class="n">odm_loc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">48960</span>
                             <span class="n">odm_conf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">24480</span>
                              <span class="n">arm_loc</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">48960</span>
                             <span class="n">arm_conf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1</span><span class="o">*</span><span class="mi">24480</span>
</pre></div>
</div>
<p>After compilation finished, elf file, kernel info file and kernel graph files are generated and saved.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>board_file_zcu104_5G
|-- dpu_refinedet_5G.elf
|-- refinedet_5G_kernel.info
`-- refinedet_5G_kernel_graph.gv
</pre></div>
</div>
<p>Using the same step and command in the folder containing the deploy model for baseline model, we could also generate elf file for baseline model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>board_file_zcu104_125G
|-- dpu_refinedet_125G.elf
|-- refinedet_125G_kernel.info
`-- refinedet_125G_kernel_graph.gv
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-on-board">
<h2>Test on Board<a class="headerlink" href="#test-on-board" title="Permalink to this headline">¶</a></h2>
<p>Before starting this part, please make sure:</p>
<ul class="simple">
<li><p>the zcu104 board is running with Vitis AI 1.1 release board image and Vitis AI Library/VART are installed correctly based on previouse modules</p></li>
<li><p>host and zcu104 board are in same network. In our example, board IP (TARGET_IP) is 10.176.18.133</p></li>
</ul>
<div class="section" id="transfer-compiler-output-to-board">
<h3>Transfer Compiler Output to Board<a class="headerlink" href="#transfer-compiler-output-to-board" title="Permalink to this headline">¶</a></h3>
<p>Tranfer the compiler output <code class="docutils literal notranslate"><span class="pre">board_file_zcu104_5G</span></code> and <code class="docutils literal notranslate"><span class="pre">board_file_zcu104_125G</span></code> to board and place it under <code class="docutils literal notranslate"><span class="pre">~/overview/samples/refinedet</span></code> with scp command</p>
<p><code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">-r</span> <span class="pre">/PATH_TO/board_file_zcu104_5G</span> <span class="pre">root&#64;10.176.18.133:~/overview/samples/refinedet</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">-r</span> <span class="pre">/PATH_TO/board_file_zcu104_125G</span> <span class="pre">root&#64;10.176.18.133:~/overview/samples/refinedet</span></code></p>
</div>
<div class="section" id="connect-to-board">
<h3>Connect to Board<a class="headerlink" href="#connect-to-board" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">root&#64;10.176.18.133</span></code></p>
<p>enter password root to connect to the board.</p>
<p>Go to refinedet example application folder</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/overview/samples/refinedet</span></code></p>
</div>
<div class="section" id="create-model-file-folder">
<h3>Create Model File Folder<a class="headerlink" href="#create-model-file-folder" title="Permalink to this headline">¶</a></h3>
<p>Copy model file folder example into current folder</p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/usr/share/vitis_ai_library/models/refinedet_pruned_0_96/</span> <span class="pre">refinedet_test_5G/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">/usr/share/vitis_ai_library/models/refinedet_pruned_0_96/</span> <span class="pre">refinedet_test_125G/</span></code></p>
<p>Copy elf files generated by ourselves into folder <code class="docutils literal notranslate"><span class="pre">refinedet_test_5G</span></code> and <code class="docutils literal notranslate"> <span class="pre">refinedet_test_125G/</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">board_file_zcu104_5G/dpu_refinedet_5G.elf</span> <span class="pre">refinedet_test_5G/refinedet_5G.elf</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">board_file_zcu104_125G/dpu_refinedet_125G.elf</span> <span class="pre">refinedet_test_125G/refinedet_125G.elf</span></code></p>
</div>
<div class="section" id="run-the-application">
<h3>Run the application<a class="headerlink" href="#run-the-application" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Performance test</p>
<p>For example we could test performance in 60s with 4 threads with following command</p>
<p><code class="docutils literal notranslate"><span class="pre">./test_performance_refinedet</span> <span class="pre">refinedet_test_5G/</span> <span class="pre">test_performance_refinedet.list</span> <span class="pre">-t</span> <span class="pre">4</span> <span class="pre">-s</span> <span class="pre">60</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.886174</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">175</span><span class="p">]</span> <span class="n">writing</span> <span class="n">report</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">STDOUT</span><span class="o">&gt;</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">18.951648</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">0</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">28.951963</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">10</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">38.952139</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">20</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.952313</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">30</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">58.952564</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">40</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">08.953136</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">50</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">18.953428</span> <span class="mi">21870</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">210</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="n">threads</span> <span class="n">terminated</span>
<span class="n">FPS</span><span class="o">=</span><span class="mf">235.63</span>
<span class="n">E2E_MEAN</span><span class="o">=</span><span class="mf">16964.4</span>
<span class="n">DPU_MEAN</span><span class="o">=</span><span class="mf">14459.7</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">./test_performance_refinedet</span> <span class="pre">refinedet_test_125G/</span> <span class="pre">test_performance_refinedet.list</span> <span class="pre">-t</span> <span class="pre">4</span> <span class="pre">-s</span> <span class="pre">60</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">38.699662</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">175</span><span class="p">]</span> <span class="n">writing</span> <span class="n">report</span> <span class="n">to</span> <span class="o">&lt;</span><span class="n">STDOUT</span><span class="o">&gt;</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">38.773613</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">0</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">48.773798</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">10</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">58.773970</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">20</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">08.774128</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">30</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">18.775049</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">40</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">28.775233</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">201</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="mi">50</span><span class="o">/</span><span class="mi">60</span> <span class="n">seconds</span><span class="p">,</span> <span class="mi">4</span> <span class="n">threads</span> <span class="n">running</span>
<span class="n">I0513</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">38.775465</span>  <span class="mi">3631</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">210</span><span class="p">]</span> <span class="n">waiting</span> <span class="k">for</span> <span class="n">threads</span> <span class="n">terminated</span>
<span class="n">FPS</span><span class="o">=</span><span class="mf">18.2661</span>
<span class="n">E2E_MEAN</span><span class="o">=</span><span class="mi">218638</span>
<span class="n">DPU_MEAN</span><span class="o">=</span><span class="mi">216079</span>
</pre></div>
</div>
</li>
</ul>
<p>From comparison we can see huge performance improvement between baseline model and pruned model which is brought by AI optimizer. The non-linear FPS improvement ratio vs compression ratio is because of</p>
<ul class="simple">
<li><p>network efficiency on DPU decreases at some extent after network size decreases</p></li>
<li><p>DPU time percentage significantly decreases in whole application time. Software processing and scheduling overhead increase will affect end-to-end FPS performance</p></li>
</ul>
<p>In the other module in advanced section, we will introduce how to use AI optimizer to achieve network optimization to reduce network from 125G to 5G.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this module, we use a Caffe detection network (RefineDet) introduce following items:</p>
<ul class="simple">
<li><p>how to use pre-trained model from Vitis AI model zoo, generate dateset and test it with provided scripts</p></li>
<li><p>how to start from original network, make necessary modification, conduct trainning and get to the version provide in the model zoo</p></li>
<li><p>how to quantize and compile the model with ready-to-use Vitis AI toolchain inside docker</p></li>
<li><p>how to deploy the network with Vitis AI library and run on the board</p></li>
</ul>
<p>Hope you enjoy it and let’s move to <a class="reference external" href="../Module_6/">next module</a> .</p>
<p class="sphinxhide" align="center"><sup>Copyright&copy; 2020-2021 Xilinx</sup></p></div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020–2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>